---
title: 测试
date: 2018-08-25 00:00:00
top: 0
---
## 测试
第一篇博客
## 1. 代码
```
echo "Hello, world!"
```

## 2. 图片
![年轻彗星的肖像](年轻彗星的肖像.jpg)

## 3. 链接
[cppreference](https://zh.cppreference.com/w/%E9%A6%96%E9%A1%B5)

## 4. 表格
| Signal | Hotkey |
| :--- | :--- |
| SIGINT | Ctrl+C |
| SIGQUIT | Ctrl+\ |
| SIGSTOP | Ctrl+Z |

## 5. hexo相关说明
参考[hexo-docs](https://hexo.io/zh-cn/docs/commands.html)

### 5.1 创建新博客
```
hexo new "my-blog"
```
首先上传图片需要将\_config.yml的`post_asset_folder`字段设置为true，之后创建文章时会自动建立同名目录。
然后在根目录(即\_config.yml所在目录)下安装相应包
```
npm install https://github.com/CodeFalling/hexo-asset-image --save
```

### 5.2 在本机开启HTTP服务器
```
hexo s
```
Markdown的渲染效果在不同平台上不是一致的，嗯，比如有道云笔记上每次要在末尾敲2个空格才能换行。因此开启HTTP服务器可以查看hexo博客的实际效果，因为最终是转换成html上传至github的。
s即server，默认端口4000，可以通过`-p`选项指定端口。

### 5.3 上传至github
```
hexo d
```
d即deploy，`-g`选项可以在部署之前预先生成静态文件。

### 5.4 在其他终端克隆和更新
参考[如何解决github+Hexo的博客多终端同步问题](https://blog.csdn.net/Monkey_LZL/article/details/60870891)
最初的时候进入hexo目录，新建hexo分支然后上传markdown源码以及其他配置
```
git init
git add source themes _config.yml package.json
git commit -m "blog source"
git branch hexo
git checkout hexo
git remote add origin git@github.com:BewareMyPower/BewareMyPower.github.io.git
git push origin hexo
```

首先克隆hexo分支(即保存markdown源码的分支)到本地
```
git clone -b hexo
```
其中`branch`新建分支，`checkout`切换分支，然后提交到自己的仓库中。
完成这步之后就可以在各终端克隆hexo分支然后修改markdown源码了
```
git clone -b hexo git@github.com:BewareMyPower/BewareMyPower.github.io.git
```
其中`-b`选项指定克隆的分支。至于master分支的提交是由`hexo`命令自动完成的，因此修改博客后，首先`npm install`添加必要的库，然后用`hexo s`查看博客效果确认无误后便可以上传。
```
git add source
git commit -m "update"
git push origin hexo
hexo d -g
```
其中`hexo d -g`会自动将markdown转换成html静态页面然后上传到master分支，而`push`命令则是保存markdown源码，因此通过两个分支的方式完成源码和编译后文件的上传。

## 6. 遇到的问题
在阿里云上`hexo init`会出错:
```
INFO  Install dependencies
npm WARN deprecated titlecase@1.1.2: no longer maintained
npm WARN deprecated postinstall-build@5.0.2: postinstall-build's behavior is now built into npm! You should migrate off of postinstall-build and use the new `prepare` lifecycle script with npm 5.0.0 or greater.

> nunjucks@3.1.3 postinstall /root/hexo/node_modules/nunjucks
> node postinstall-build.js src

sh: 1: node: Permission denied
npm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@1.2.4 (node_modules/fsevents):
npm WARN notsup SKIPPING OPTIONAL DEPENDENCY: Unsupported platform for fsevents@1.2.4: wanted {"os":"darwin","arch":"any"} (current: {"os":"linux","arch":"x64"})

npm ERR! file sh
npm ERR! code ELIFECYCLE
npm ERR! errno ENOENT
npm ERR! syscall spawn
npm ERR! nunjucks@3.1.3 postinstall: `node postinstall-build.js src`
npm ERR! spawn ENOENT
npm ERR!
npm ERR! Failed at the nunjucks@3.1.3 postinstall script.
npm ERR! This is probably not a problem with npm. There is likely additional logging output above.

npm ERR! A complete log of this run can be found in:
npm ERR!     /root/.npm/_logs/2018-08-24T16_41_59_170Z-debug.log
WARN  Failed to install dependencies. Please run 'npm install' manually!
```
真实原因是`sh: 1: node: Permission denied`这句，其他的WARNING都不是关键问题。权限指的是npm的权限，可以查看配置
```
# npm config
npm ERR! Usage:
npm ERR! npm config set <key> <value>
npm ERR! npm config get [<key>]
npm ERR! npm config delete <key>
npm ERR! npm config list [--json]
npm ERR! npm config edit
npm ERR! npm set <key> <value>
npm ERR! npm get [<key>]
npm ERR!
npm ERR! alias: c
```
默认用户ID为500，因此要把它设为0，另外还要把unsafe-perm设为true，设置完后实际保存在了.npmrc文件中，就像`git config`的配置保存在.gitconfig文件中一样。
```
~# npm config set user 0
~# npm config set unsafe-perm true
~# cat .npmrc
user=0
unsafe-perm=true
```
之后`hexo init`就能成功了，弹出信息如下所示
```
INFO  Install dependencies
npm WARN deprecated titlecase@1.1.2: no longer maintained
npm WARN deprecated postinstall-build@5.0.2: postinstall-build's behavior is now built into npm! You should migrate off of postinstall-build and use the new `prepare` lifecycle script with npm 5.0.0 or greater.

> nunjucks@3.1.3 postinstall /root/xxx/node_modules/nunjucks
> node postinstall-build.js src

npm notice created a lockfile as package-lock.json. You should commit this file.
npm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@1.2.4 (node_modules/fsevents):
npm WARN notsup SKIPPING OPTIONAL DEPENDENCY: Unsupported platform for fsevents@1.2.4: wanted {"os":"darwin","arch":"any"} (current: {"os":"linux","arch":"x64"})

added 396 packages in 18.772s
INFO  Start blogging with Hexo!
```
可见，该有的WARNING还是得有。
